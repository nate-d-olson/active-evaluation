

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>aegis.oracle.oracle &mdash; aegis v2020.04.03_dev documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> aegis
          

          
          </a>

          
            
            
              <div class="version">
                v2020.04.03_dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Aegis Package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#quick-start">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#running-experiments-with-aegis-when-ground-truth-is-known">Running Experiments with Aegis when Ground Truth is Known</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#code-approach">Code Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#running-continuous-integration-components-locally">Running Continuous Integration Components Locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#license">LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html#disclaimer">Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../API_reference.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">aegis</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>aegis.oracle.oracle</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for aegis.oracle.oracle</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">import</span> <span class="nn">aegis.acteval.data_processor</span>
<span class="kn">import</span> <span class="nn">aegis.acteval.strata</span>
<span class="kn">import</span> <span class="nn">aegis.acteval.metrics</span>
<span class="kn">import</span> <span class="nn">aegis.acteval.samplers</span>
<span class="kn">import</span> <span class="nn">aegis.acteval.controller</span>
<span class="kn">import</span> <span class="nn">aegis.acteval.experiment</span>


<div class="viewcode-block" id="compute_var"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.compute_var">[docs]</a><span class="k">def</span> <span class="nf">compute_var</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to compute var, using Using Var(x) = E(X^2) - E(X)^2.</span>
<span class="sd">    Extracts columns &#39;total_score_diff_sq&#39; and `avg_score_diff` from data frame row.</span>

<span class="sd">    Because of floating point computations, variance may be slightly negative (near 0)</span>

<span class="sd">    Args:</span>
<span class="sd">        row (:obj:`pandas.core.series.Series`): row of data frame</span>
<span class="sd">        n (int): the number of examples</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: A computed variance (square of the standard deviation).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;total_score_diff_sq&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;avg_score_diff&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="Oracle"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.Oracle">[docs]</a><span class="k">class</span> <span class="nc">Oracle</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Constructor. &quot;&quot;&quot;</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;paper_experiments_logger&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Initiating oracle class&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="Oracle.get_annotations"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.Oracle.get_annotations">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_samples</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a (trial_id, key) pandas data frame with just the suggested trials</span>

<span class="sd">        Args:</span>
<span class="sd">            trial_samples (list of object): A list of trial_id values to get the annotations for</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.core.frame.DataFrame: A two-column data frame with columns &quot;trial_id&quot; and &quot;key&quot;.</span>
<span class="sd">            Resets the index</span>
<span class="sd">            so that the index does not inadvertently contain information.</span>

<span class="sd">        &quot;&quot;&quot;</span></div></div>


<div class="viewcode-block" id="OracleScript"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript">[docs]</a><span class="k">class</span> <span class="nc">OracleScript</span><span class="p">(</span><span class="n">Oracle</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Oracle Script that assumes we have the ground truth for all trials stored separately.</span>
<span class="sd">    This Oracle Script is useful for automating experiments when results are known.</span>
<span class="sd">    Because OracleScript objects have a full key, we implement methods useful for experimental</span>
<span class="sd">    simulations that leverage our knowledge of the full key on the data set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Do we want to call the data processor for the oracle class? Right now, we do not</span>
    <span class="c1"># oracle_data_processor = acteval.data_processor.DataProcessor()</span>
    <span class="n">key_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    pandas.DataFrame: The read in data frame of the answer key.</span>

<span class="sd">    Two columns: &quot;trial_id&quot; and &quot;key&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_file</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>
<span class="sd">        Args:</span>
<span class="sd">            key_file (string): The filepath to the key data frame. The data frame should have two</span>
<span class="sd">                columns: &quot;trial_id&quot; and &quot;key&quot;, with the key corresponding to that trial id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">key_file</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

<div class="viewcode-block" id="OracleScript.get_key_df_copy"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.get_key_df_copy">[docs]</a>    <span class="k">def</span> <span class="nf">get_key_df_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a deep copy of the data frame.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.core.frame.DataFrame: A copy of the key data frame.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_df</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleScript.get_annotations"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.get_annotations">[docs]</a>    <span class="k">def</span> <span class="nf">get_annotations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trial_samples</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a (trial_id, key) pandas data frame with just the suggested trials.</span>
<span class="sd">        This implementation takes the relevant rows from the key file.</span>

<span class="sd">        Args:</span>
<span class="sd">            trial_samples (list of object): A list of trial_id values to get the annotations for</span>

<span class="sd">        Returns:</span>
<span class="sd">            pandas.core.frame.DataFrame: A two-column data frame with columns &quot;trial_id&quot; and &quot;key&quot;.</span>
<span class="sd">            Resets the index so that the index does not inadvertently contain information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">annotation_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_df</span><span class="p">[</span><span class="s2">&quot;trial_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">trial_samples</span><span class="p">),</span> <span class="p">:</span>
        <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">annotation_df</span></div>

<div class="viewcode-block" id="OracleScript.get_actual_score_all_systems"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.get_actual_score_all_systems">[docs]</a>    <span class="k">def</span> <span class="nf">get_actual_score_all_systems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_fpaths</span><span class="p">,</span> <span class="n">threshold_fpaths</span><span class="p">,</span> <span class="n">metric</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uses the full key file to get the actual score for each system with the specified metric</span>
<span class="sd">        object.</span>

<span class="sd">        Args:</span>
<span class="sd">            system_fpaths (list of str): The list of filepaths to the systems</span>
<span class="sd">            threshold_fpaths (list of str): The list of filepaths to the thresholds</span>
<span class="sd">            metric (:obj:`aegis.acteval.metrics.Metric`): The metric object that will</span>
<span class="sd">                score the systems</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of float: A list of scores, one per system in the order of the files in</span>
<span class="sd">            system_fpaths</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_data_processor</span> <span class="o">=</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">data_processor</span><span class="o">.</span><span class="n">DataProcessor</span><span class="p">()</span>
        <span class="n">system_list</span> <span class="o">=</span> <span class="n">my_data_processor</span><span class="o">.</span><span class="n">process_systems_with_thresholds</span><span class="p">(</span><span class="n">system_fpaths</span><span class="p">,</span>
                                                                        <span class="n">threshold_fpaths</span><span class="p">)</span>
        <span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">convert_thresholds_to_decisions</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="k">for</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">system_list</span><span class="p">]</span>

        <span class="n">system_df_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">system</span><span class="o">.</span><span class="n">system_df</span> <span class="k">for</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">system_list</span><span class="p">]</span>
        <span class="n">system_accuracy_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">get_actual_score</span><span class="p">(</span><span class="n">system_df</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_df</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">system_df</span> <span class="ow">in</span> <span class="n">system_df_list</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">system_accuracy_list</span></div>

<div class="viewcode-block" id="OracleScript.is_within_ci_all_systems"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.is_within_ci_all_systems">[docs]</a>    <span class="k">def</span> <span class="nf">is_within_ci_all_systems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_list</span><span class="p">,</span> <span class="n">actual_score_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the system objects and their actual system scores, provide a list of booleans</span>
<span class="sd">        that tells us if each system&#39;s estimate confidence interval contains the actual score.</span>

<span class="sd">        Args:</span>
<span class="sd">            system_list (list of :obj:`aegis.acteval.system.System`): The list of system objects</span>
<span class="sd">            actual_score_list (list of float): The actual score of the systems</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of bool: A list of boolean values that each entry is True if the true score</span>
<span class="sd">            is contained in the</span>
<span class="sd">            confidence interval for that system, and False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">system</span><span class="o">.</span><span class="n">score</span> <span class="o">-</span> <span class="n">system</span><span class="o">.</span><span class="n">confidence_value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">score</span> <span class="o">&lt;=</span>
                <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">score</span> <span class="o">+</span> <span class="n">system</span><span class="o">.</span><span class="n">confidence_value</span><span class="p">)</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">system_list</span><span class="p">,</span> <span class="n">actual_score_list</span><span class="p">)]</span></div>

<div class="viewcode-block" id="OracleScript.system_within_ci"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.system_within_ci">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_within_ci</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">actual_score</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a single system object and its actual core, provides a boolean</span>
<span class="sd">        that tells us if that system&#39;s estimate confidence interval contains the actual score.</span>

<span class="sd">        Args:</span>
<span class="sd">            system (:obj:`aegis.acteval.system.System`): The system object</span>
<span class="sd">            actual_score (float): The actual score of the system</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: A boolean values that is True if the true score is contained in the</span>
<span class="sd">            confidence interval for that system, and False otherwise.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">score</span> <span class="o">-</span> <span class="n">system</span><span class="o">.</span><span class="n">confidence_value</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">actual_score</span> <span class="o">&lt;=</span> \
               <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">score</span> <span class="o">+</span> <span class="n">system</span><span class="o">.</span><span class="n">confidence_value</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleScript.all_within_ci"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.all_within_ci">[docs]</a>    <span class="k">def</span> <span class="nf">all_within_ci</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_list</span><span class="p">,</span> <span class="n">actual_score_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a list system objects and their actual system scores, provides a list of booleans</span>
<span class="sd">        that tells us if each system&#39;s estimate confidence interval contains the actual score.</span>

<span class="sd">        Args:</span>
<span class="sd">            system_list (list of :obj:`aegis.acteval.system.System`): The list of system objects</span>
<span class="sd">            actual_score_list (list of float): The actual score of the systems</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of bool: A list of boolean values where each entry is True if the true score is</span>
<span class="sd">            contained in the</span>
<span class="sd">            confidence interval for that system, and False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ci_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">OracleScript</span><span class="o">.</span><span class="n">system_within_ci</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
                   <span class="k">for</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">system_list</span><span class="p">,</span> <span class="n">actual_score_list</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">ci_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleScript.system_within_delta"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.system_within_delta">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">system_within_delta</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">actual_score</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a single system object and its actual core, provide a boolean</span>
<span class="sd">        that tells us if that system&#39;s estimate is within +- delta of the actual score</span>

<span class="sd">        Args:</span>
<span class="sd">            system (:obj:`aegis.acteval.system.System`): The system object</span>
<span class="sd">            actual_score (float): The actual score of the system</span>
<span class="sd">            delta (float): The specified error range</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: A boolean values that is True if the system&#39;s true score is</span>
<span class="sd">            contained in the</span>
<span class="sd">            interval of system estimate +- delta, and False otherwise.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">score</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">actual_score</span> <span class="o">&lt;=</span> \
               <span class="p">(</span><span class="n">system</span><span class="o">.</span><span class="n">score</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleScript.all_within_delta"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.all_within_delta">[docs]</a>    <span class="k">def</span> <span class="nf">all_within_delta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">system_list</span><span class="p">,</span> <span class="n">actual_score_list</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the system objects and their actual system scores, provide a list of booleans</span>
<span class="sd">        that tells us if each system&#39;s estimate +- delta contains the actual score.</span>

<span class="sd">        Args:</span>
<span class="sd">            system_list (list of :obj:`aegis.acteval.system.System`): The list of system objects</span>
<span class="sd">            actual_score_list (list of float): The actual score of the systems</span>
<span class="sd">            delta (float): the specified delta value</span>

<span class="sd">        Returns:</span>
<span class="sd">            list of bool: A list of boolean values where each entry is True if the true score is</span>
<span class="sd">            contained in the</span>
<span class="sd">            interval of system estimate is +- delta, and False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ci_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">OracleScript</span><span class="o">.</span><span class="n">system_within_delta</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
                   <span class="k">for</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">system_list</span><span class="p">,</span> <span class="n">actual_score_list</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">ci_list</span><span class="p">)</span></div>

<div class="viewcode-block" id="OracleScript.get_experiment_result_data"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.get_experiment_result_data">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_experiment_result_data</span><span class="p">(</span><span class="n">oracle_ref</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">metric_object</span><span class="p">,</span>
                                   <span class="n">stratification_type</span><span class="p">,</span>
                                   <span class="n">num_strata</span><span class="p">,</span>
                                   <span class="n">sampler_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">sampler_categories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">system_ordering</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">bin_style_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">use_multinomials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">num_success_rounds_required</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                   <span class="n">num_step_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                                   <span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">use_initial_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">request_initial_samples</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">initial_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">parallelize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">final_log_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                   <span class="n">sample_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">num_req_systems</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The component of &quot;run_experiment&quot; that runs the data frames and returns</span>
<span class="sd">            the data frames. By default, it runs an entire experiment but can</span>
<span class="sd">            be customized to run smaller experiments.</span>

<span class="sd">            Args:</span>
<span class="sd">                oracle_ref (:obj:`aegis.oracle.oracle.Oracle`):</span>
<span class="sd">                    the Oracle object to call to get additional trials</span>
<span class="sd">                input_dir (str): The path to the input directory of the submission</span>
<span class="sd">                metric_object (:obj:`aegis.acteval.metrics.Metric`):</span>
<span class="sd">                    The reference to the metric object that specifies how the trials will be scored</span>
<span class="sd">                stratification_type (:obj:`aegis.acteval.strata.Strata`):</span>
<span class="sd">                    Strata class that gives the stratification strategy and type of strata</span>
<span class="sd">                num_strata (int): The number of strata to have.</span>
<span class="sd">                sampler_types (list of :obj:`abc.ABCMeta`, optional):</span>
<span class="sd">                    List of samplers you wish to use in experiment. Defaults to None, which</span>
<span class="sd">                    resolves to</span>
<span class="sd">                    [aegis.acteval.samplers.UniformTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.UniformFixedTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.ProportionalTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.ProportionalFixedTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.AdaptiveTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.AdaptiveFixedTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.RandomTrialSampler,</span>
<span class="sd">                    aegis.acteval.samplers.RandomFixedTrialSampler]</span>
<span class="sd">                sampler_categories (list of str, optional): List of sampler categories you</span>
<span class="sd">                    want to use in experiment. Defaults to None, which resolves as</span>
<span class="sd">                    [&quot;Uniform&quot;, &quot;Uniform&quot;, &quot;Proportional&quot;, &quot;Proportional&quot;,</span>
<span class="sd">                    &quot;Adaptive&quot;, &quot;Adaptive&quot;, &quot;Random&quot;, &quot;Random&quot;].</span>
<span class="sd">                system_ordering (list of str): The desired ordering of systems, if the order</span>
<span class="sd">                    is important. Order is specified by system id.</span>
<span class="sd">                    None, which resolves to [] By</span>
<span class="sd">                    default. One can also give an ordering of only some of the systems to run the</span>
<span class="sd">                    experiment on a subset of systems in the submission. [] Runs all systems in an</span>
<span class="sd">                    arbitrary ordering.</span>
<span class="sd">                bin_style_types (list of str, optional): List of bin style types you want to</span>
<span class="sd">                    use in experiment. Defaults to None, which resolves as [&#39;equal&#39;, &#39;perc&#39;].</span>
<span class="sd">                use_multinomials (list of bool, optional): List of booleans for each sampler type</span>
<span class="sd">                    Defaults to None, which resolves as</span>
<span class="sd">                    [True, False, True, False, True, False, True, False].</span>
<span class="sd">                num_success_rounds_required (int, optional):</span>
<span class="sd">                    The number of rounds where the (1-\\alpha) confidence</span>
<span class="sd">                    interval&#39;s range is within +- $\\delta width. Defaults to 2</span>
<span class="sd">                num_step_samples (int, optional): the number of samples to ask for at each iteration</span>
<span class="sd">                    defaults to 100</span>
<span class="sd">                alpha (num, optional): The specified probability \\alpha. Defaults to 0.05.</span>
<span class="sd">                delta (num, optional): The specified interval range \\delta. Defaults to 0.01</span>
<span class="sd">                num_iterations (int, optional): The number of iterations to run each sampler for.</span>
<span class="sd">                    Defaults to 1000</span>
<span class="sd">                use_initial_df (bool, optional): A variable that tells is to use an initial</span>
<span class="sd">                    data frame if provided</span>
<span class="sd">                    for initial samples. Defaults to True.</span>
<span class="sd">                request_initial_samples (bool, optional):</span>
<span class="sd">                    A boolean that determines if the experiment (and hence) the</span>
<span class="sd">                    controller should request or supplement initial samples with initial samples</span>
<span class="sd">                    to provide for adequate stratum and metric coverage for initial estimates.</span>
<span class="sd">                    True by default.</span>
<span class="sd">                initial_samples (int, optional): The number of samples to request initially.</span>
<span class="sd">                    Defaults to 100.</span>
<span class="sd">                parallelize (bool, optional): A boolean determining whether to parallelize. True</span>
<span class="sd">                    parallelizes with joblib, False runs in serial. Defaults to True</span>
<span class="sd">                random_seed (int, optional): The desired random seed. Set to None if it is desired</span>
<span class="sd">                    for the experiment to not be seeded. Defaults to None.</span>
<span class="sd">                final_log_path (str, optional): A string which dictates the log file path</span>
<span class="sd">                    that all tmp file logs will be written to. Defaults to None and will</span>
<span class="sd">                    simply just not write to any logfile if no string is given.</span>
<span class="sd">                sample_first (bool, optional): Used to flag sample first for certain strata methods.</span>
<span class="sd">                num_req_system (int, optional): Used to request a certain number of systems,</span>
<span class="sd">                    used for specific strata techniques.</span>
<span class="sd">            Returns:</span>
<span class="sd">                (pandas.core.frame.DataFrame, pandas.core.frame.Dataframe): The two data</span>
<span class="sd">                frames (summary_out_df, results_out_df) as a tuple so that they</span>
<span class="sd">                can be written to a file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Place default arguments here so that no default arguments are mutable</span>
        <span class="k">if</span> <span class="n">system_ordering</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">system_ordering</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">sampler_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sampler_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">UniformTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">UniformFixedTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">ProportionalTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">ProportionalFixedTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">AdaptiveTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">AdaptiveFixedTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomFixedTrialSampler</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sampler_categories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sampler_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Uniform&quot;</span><span class="p">,</span> <span class="s2">&quot;Uniform&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Proportional&quot;</span><span class="p">,</span> <span class="s2">&quot;Proportional&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Adaptive&quot;</span><span class="p">,</span> <span class="s2">&quot;Adaptive&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Random&quot;</span><span class="p">,</span> <span class="s2">&quot;Random&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">bin_style_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bin_style_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;perc&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">use_multinomials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">use_multinomials</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

        <span class="n">my_data_processor</span> <span class="o">=</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">data_processor</span><span class="o">.</span><span class="n">DataProcessor</span><span class="p">()</span>
        <span class="n">init_fpath</span><span class="p">,</span> <span class="n">trial_data_fpath</span><span class="p">,</span> <span class="n">system_fpaths</span><span class="p">,</span> <span class="n">threshold_fpaths</span> <span class="o">=</span> \
            <span class="n">my_data_processor</span><span class="o">.</span><span class="n">extract_files_from_directory</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">system_ordering</span><span class="p">)</span>
        <span class="n">num_systems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">system_fpaths</span><span class="p">)</span>
        <span class="n">dataset_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">input_dir</span><span class="p">)</span>
        <span class="n">sys_order_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">system_ordering</span><span class="p">)</span>
        <span class="c1"># Experimental parameters that are constant across all experiments</span>
        <span class="n">my_metric</span> <span class="o">=</span> <span class="n">metric_object</span>

        <span class="n">my_controller</span> <span class="o">=</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">controller</span><span class="o">.</span><span class="n">Controller</span><span class="p">()</span>

        <span class="c1"># Score the system against the key to get the accuracy</span>
        <span class="n">system_accuracy_list</span> <span class="o">=</span> <span class="n">oracle_ref</span><span class="o">.</span><span class="n">get_actual_score_all_systems</span><span class="p">(</span><span class="n">system_fpaths</span><span class="p">,</span>
                                                                       <span class="n">threshold_fpaths</span><span class="p">,</span>
                                                                       <span class="n">my_metric</span><span class="p">)</span>
        <span class="c1"># Experimental parameters that vary</span>
        <span class="n">sampler_type_list</span> <span class="o">=</span> <span class="n">sampler_types</span>
        <span class="n">sampler_category</span> <span class="o">=</span> <span class="n">sampler_categories</span>
        <span class="n">bin_style_types</span> <span class="o">=</span> <span class="n">bin_style_types</span>
        <span class="n">uses_multinomial</span> <span class="o">=</span> <span class="n">use_multinomials</span>

        <span class="n">sampler_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">sampler_type_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sampler_type&quot;</span><span class="p">])</span>
        <span class="n">sampler_df</span><span class="p">[</span><span class="s1">&#39;sampler_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampler_category</span>
        <span class="n">sampler_df</span><span class="p">[</span><span class="s1">&#39;uses_multinomial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uses_multinomial</span>
        <span class="n">bin_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bin_style_types</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;bin_style&quot;</span><span class="p">])</span>

        <span class="c1"># For summary data frame</span>
        <span class="n">summary_df</span> <span class="o">=</span> <span class="n">sampler_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">bin_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_relevant_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;num_within_ci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;num_within_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_score_diff_sq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s2">&quot;sampler_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;metric_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_object</span><span class="o">.</span><span class="n">get_metric_name</span><span class="p">()</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataset_name</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;system_ordering&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys_order_str</span>
        <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;stratification_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stratification_type</span>

        <span class="c1"># Do not feed initial files if desired to not use</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_initial_df</span><span class="p">:</span>
            <span class="n">init_fpath</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">process_iteration</span><span class="p">(</span><span class="n">iter_num</span><span class="p">,</span> <span class="n">sampler_type</span><span class="p">,</span> <span class="n">bin_style</span><span class="p">,</span> <span class="n">stratification_type</span><span class="p">,</span>
                              <span class="n">num_strata</span><span class="p">,</span>
                              <span class="n">submission_dirname</span><span class="p">,</span> <span class="n">sys_ordering</span><span class="p">,</span>
                              <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sample_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_req_systems</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Process an experiment. Most parameters for the experiment come from the experiment file</span>
<span class="sd">            in which this method is defined. This method, in addition to returning summarized output</span>
<span class="sd">            as a 4-tuple, writes the fuller experiment summary to a text file.</span>

<span class="sd">            Args:</span>
<span class="sd">                iter_num (int): the current iteration. Used by joblib and to identify file output</span>
<span class="sd">                sampler_type (:obj:`abc.ABCMeta`): the sampler type for the experiment.</span>
<span class="sd">                bin_style (str): the bin style for the stratifications.</span>
<span class="sd">                stratification_type (:obj:`abc.ABCMeta`): The type of stratification used</span>
<span class="sd">                num_strata: the number of strata to use</span>
<span class="sd">                submission_dirname (str): The name of the submission directory</span>
<span class="sd">                sys_ordering (str): The system ordering provided</span>
<span class="sd">                random_state (:obj:`numpy.random.RandomState`, optional): The random state based</span>
<span class="sd">                    on the seed. If None, then the randomization</span>
<span class="sd">                    is not seeded. Defaults to None.</span>
<span class="sd">                sample_first (bool, optional): Used to flag sample first for certain strata methods.</span>
<span class="sd">                num_req_system (int, optional): Used to request a certain number of systems,</span>
<span class="sd">                    used for specific strata techniques.</span>

<span class="sd">            Returns:</span>
<span class="sd">                (int, abc.ABCMeta, str, pandas.core.series.Series):</span>
<span class="sd">                Rows as a list of tuples that can be easily converted to a rows in a</span>
<span class="sd">                pandas data frame, one row per tuple.</span>
<span class="sd">                (iter_num, sampler_type, bin_style, report_tuple) as an expanded tuple. Returns</span>
<span class="sd">                one row per system for ease of processing.</span>

<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># Give a new random state</span>
            <span class="k">if</span> <span class="n">random_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># np.random.seed(seed=random_state)</span>
                <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random_state</span><span class="p">)</span>
            <span class="c1"># Handle UniformRandom case with this preamble block</span>
            <span class="n">my_sampler</span> <span class="o">=</span> <span class="n">sampler_type</span>

            <span class="n">sampler_name</span> <span class="o">=</span> <span class="n">sampler_type</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">my_sampler</span> <span class="o">==</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomTrialSampler</span><span class="p">:</span>
                <span class="n">num_strata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">elif</span> <span class="n">my_sampler</span> <span class="o">==</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomFixedTrialSampler</span><span class="p">:</span>
                <span class="n">num_strata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c1"># run experiment and write the outputs</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paper_experiments_logger&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span> <span class="o">+</span>
                                       <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sampler_type</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bin_style</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
            <span class="n">logfile_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sampler_type</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="n">bin_style</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tmp&#39;</span><span class="p">)</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile_fpath</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Experiment&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sampler_type</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bin_style</span><span class="p">))</span>
            <span class="n">my_experiment</span> <span class="o">=</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span> \
                <span class="n">ExperimentParams</span><span class="p">(</span><span class="n">num_step_samples</span><span class="o">=</span><span class="n">num_step_samples</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
                                 <span class="n">num_success_rounds_required</span><span class="o">=</span><span class="n">num_success_rounds_required</span><span class="p">,</span>
                                 <span class="n">num_strata</span><span class="o">=</span><span class="n">num_strata</span><span class="p">,</span>
                                 <span class="n">metric_object</span><span class="o">=</span><span class="n">metric_object</span><span class="p">,</span>
                                 <span class="n">stratification_type</span><span class="o">=</span><span class="n">stratification_type</span><span class="p">,</span>
                                 <span class="n">sampler_type</span><span class="o">=</span><span class="n">my_sampler</span><span class="p">,</span>
                                 <span class="n">bin_style</span><span class="o">=</span><span class="n">bin_style</span><span class="p">,</span>
                                 <span class="n">request_initial_samples</span><span class="o">=</span><span class="n">request_initial_samples</span><span class="p">,</span>
                                 <span class="n">initial_samples</span><span class="o">=</span><span class="n">initial_samples</span><span class="p">,</span>
                                 <span class="n">sample_first</span><span class="o">=</span><span class="n">sample_first</span><span class="p">,</span>
                                 <span class="n">num_req_systems</span><span class="o">=</span><span class="n">num_req_systems</span><span class="p">)</span>
            <span class="n">exp_report</span> <span class="o">=</span> <span class="n">my_controller</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init_fpath</span><span class="p">,</span> <span class="n">trial_data_fpath</span><span class="p">,</span>
                                           <span class="n">system_fpaths</span><span class="p">,</span> <span class="n">threshold_fpaths</span><span class="p">,</span>
                                           <span class="n">oracle_ref</span><span class="p">,</span> <span class="n">my_experiment</span><span class="p">,</span> <span class="n">rng</span><span class="p">)</span>
            <span class="n">all_within_ci</span> <span class="o">=</span> <span class="n">oracle_ref</span><span class="o">.</span><span class="n">all_within_ci</span><span class="p">(</span><span class="n">exp_report</span><span class="o">.</span><span class="n">system_list</span><span class="p">,</span>
                                                     <span class="n">system_accuracy_list</span><span class="p">)</span>
            <span class="n">all_within_delta</span> <span class="o">=</span> <span class="n">oracle_ref</span><span class="o">.</span><span class="n">all_within_delta</span><span class="p">(</span><span class="n">exp_report</span><span class="o">.</span><span class="n">system_list</span><span class="p">,</span>
                                                           <span class="n">system_accuracy_list</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
            <span class="n">ci_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">aegis</span><span class="o">.</span><span class="n">oracle</span><span class="o">.</span><span class="n">oracle</span><span class="o">.</span><span class="n">OracleScript</span><span class="o">.</span><span class="n">system_within_ci</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">),</span> <span class="n">score</span><span class="p">)</span>
                       <span class="k">for</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">exp_report</span><span class="o">.</span><span class="n">system_list</span><span class="p">,</span> <span class="n">system_accuracy_list</span><span class="p">)]</span>
            <span class="n">delta_list</span> <span class="o">=</span> \
                <span class="p">[(</span><span class="n">aegis</span><span class="o">.</span><span class="n">oracle</span><span class="o">.</span><span class="n">oracle</span><span class="o">.</span><span class="n">OracleScript</span><span class="o">.</span><span class="n">system_within_delta</span><span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span> <span class="n">delta</span><span class="p">),)</span>
                 <span class="k">for</span> <span class="p">(</span><span class="n">system</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">exp_report</span><span class="o">.</span><span class="n">system_list</span><span class="p">,</span> <span class="n">system_accuracy_list</span><span class="p">)]</span>
            <span class="c1"># Take exp_report and return a tuple of items to go directly as a row in our data_frame</span>
            <span class="n">report_tuple</span> <span class="o">=</span> <span class="n">exp_report</span><span class="o">.</span><span class="n">get_experiment_report_tuple</span><span class="p">()</span>
            <span class="n">metric_object</span><span class="o">.</span><span class="n">get_metric_name</span><span class="p">()</span>
            <span class="n">sec_fac_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">my_experiment</span><span class="o">.</span><span class="n">metric_object</span><span class="o">.</span><span class="n">get_metric_name</span><span class="p">(),</span> <span class="n">submission_dirname</span><span class="p">,</span>
                             <span class="n">sys_ordering</span><span class="p">)</span>
            <span class="n">systems_tuple_list</span> <span class="o">=</span> <span class="n">exp_report</span><span class="o">.</span><span class="n">get_systems_tuples</span><span class="p">()</span>
            <span class="n">iteration_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">iter_num</span><span class="p">,</span> <span class="n">sampler_type</span><span class="p">,</span> <span class="n">sampler_name</span><span class="p">,</span> <span class="n">bin_style</span><span class="p">,</span> <span class="n">all_within_ci</span><span class="p">,</span>
                               <span class="n">all_within_delta</span><span class="p">)</span>
            <span class="n">iteration_tuple_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">iteration_tuple</span> <span class="o">+</span> <span class="n">report_tuple</span> <span class="o">+</span> <span class="n">system_tuple</span> <span class="o">+</span>
                                    <span class="n">system_within_ci</span> <span class="o">+</span> <span class="n">system_within_delta</span> <span class="o">+</span> <span class="n">sec_fac_tuple</span>
                                    <span class="k">for</span> <span class="p">(</span><span class="n">system_tuple</span><span class="p">,</span> <span class="n">system_within_ci</span><span class="p">,</span> <span class="n">system_within_delta</span><span class="p">)</span>
                                    <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">systems_tuple_list</span><span class="p">,</span> <span class="n">ci_list</span><span class="p">,</span> <span class="n">delta_list</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">iteration_tuple_list</span>

        <span class="n">global_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;paper_experiments_logger&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">random_seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>

            <span class="n">rn_state_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
                                             <span class="n">size</span><span class="o">=</span><span class="n">num_iterations</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sampler_type_list</span><span class="p">)</span> <span class="o">*</span>
                                             <span class="nb">len</span><span class="p">(</span><span class="n">bin_style_types</span><span class="p">))</span>
            <span class="n">all_iter_lists</span> <span class="o">=</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_iterations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">sampler_type_list</span><span class="p">,</span>
                              <span class="n">bin_style_types</span><span class="p">]</span>
            <span class="n">iteration_cp</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">all_iter_lists</span><span class="p">))</span>
            <span class="n">iteration_prod</span> <span class="o">=</span> <span class="p">[(</span><span class="n">rn</span><span class="p">,)</span> <span class="o">+</span> <span class="n">iter_item</span> <span class="k">for</span> <span class="p">(</span><span class="n">rn</span><span class="p">,</span> <span class="n">iter_item</span><span class="p">)</span>
                              <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rn_state_vec</span><span class="p">,</span> <span class="n">iteration_cp</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">parallelize</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span>
                    <span class="n">joblib</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">process_iteration</span><span class="p">)(</span><span class="n">iter_num</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">sampler_type</span><span class="o">=</span><span class="n">sampler_type</span><span class="p">,</span>
                                                      <span class="n">bin_style</span><span class="o">=</span><span class="n">bin_style</span><span class="p">,</span>
                                                      <span class="n">stratification_type</span><span class="o">=</span><span class="n">stratification_type</span><span class="p">,</span>
                                                      <span class="n">num_strata</span><span class="o">=</span><span class="n">num_strata</span><span class="p">,</span>
                                                      <span class="n">submission_dirname</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
                                                      <span class="n">sys_ordering</span><span class="o">=</span><span class="n">sys_order_str</span><span class="p">,</span>
                                                      <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                                      <span class="n">sample_first</span><span class="o">=</span><span class="n">sample_first</span><span class="p">,</span>
                                                      <span class="n">num_req_systems</span><span class="o">=</span><span class="n">num_req_systems</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sampler_type</span><span class="p">,</span> <span class="n">bin_style</span> <span class="ow">in</span> <span class="n">iteration_prod</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">random_state</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">sampler_type</span><span class="p">,</span> <span class="n">bin_style</span> <span class="ow">in</span> <span class="n">iteration_prod</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">process_iteration</span><span class="p">(</span><span class="n">iter_num</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                                                     <span class="n">sampler_type</span><span class="o">=</span><span class="n">sampler_type</span><span class="p">,</span>
                                                     <span class="n">bin_style</span><span class="o">=</span><span class="n">bin_style</span><span class="p">,</span>
                                                     <span class="n">stratification_type</span><span class="o">=</span><span class="n">stratification_type</span><span class="p">,</span>
                                                     <span class="n">num_strata</span><span class="o">=</span><span class="n">num_strata</span><span class="p">,</span>
                                                     <span class="n">submission_dirname</span><span class="o">=</span><span class="n">dataset_name</span><span class="p">,</span>
                                                     <span class="n">sys_ordering</span><span class="o">=</span><span class="n">sys_order_str</span><span class="p">,</span>
                                                     <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span>
                                                     <span class="n">sample_first</span><span class="o">=</span><span class="n">sample_first</span><span class="p">,</span>
                                                     <span class="n">num_req_systems</span><span class="o">=</span><span class="n">num_req_systems</span><span class="p">))</span>

            <span class="c1"># Get a nice data frame</span>
            <span class="n">results_header</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;iter_num&quot;</span><span class="p">,</span> <span class="s2">&quot;sampler_type&quot;</span><span class="p">,</span> <span class="s2">&quot;sampler_name&quot;</span><span class="p">,</span> <span class="s2">&quot;bin_style&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;all_within_ci&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;all_within_delta&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;num_step_samples&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;num_success_rounds_required&quot;</span><span class="p">,</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="s2">&quot;num_strata&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;stratification_type&quot;</span><span class="p">,</span> <span class="s2">&quot;exp_bin_style&quot;</span><span class="p">,</span> <span class="s2">&quot;metric_object&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;exp_sampler_type&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;request_initial_samples&quot;</span><span class="p">,</span> <span class="s2">&quot;initial_samples&quot;</span><span class="p">,</span> <span class="s2">&quot;sample_first&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;num_req_systems&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;total_sampled_trials&quot;</span><span class="p">,</span> <span class="s2">&quot;num_rounds&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;num_init_trials&quot;</span><span class="p">,</span> <span class="s2">&quot;num_requested_init_trials&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;num_nonempty_strata&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;system_id&quot;</span><span class="p">,</span> <span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="s2">&quot;confidence_value&quot;</span><span class="p">,</span> <span class="s2">&quot;score_variance&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;sampled_trials&quot;</span><span class="p">,</span> <span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="s2">&quot;system_within_ci&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;actual_system_score&quot;</span><span class="p">,</span> <span class="s2">&quot;system_within_delta&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;metric_name&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;system_ordering&quot;</span><span class="p">]</span>
            <span class="c1"># Using</span>
            <span class="c1"># https://stackoverflow.com/questions/952914/how-to-make-a-flat-list-out-of-</span>
            <span class="c1"># list-of-lists</span>
            <span class="c1"># to flatten lists</span>
            <span class="n">results_rows</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">:</span>
                    <span class="n">results_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results_rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">results_header</span><span class="p">)</span>
            <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;score&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;actual_system_score&#39;</span><span class="p">]</span>
            <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;score_diff_sq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_df</span><span class="p">[</span><span class="s1">&#39;score_diff&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">results_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="c1"># Check within delta not within the system&#39;s estimate of the CI for the summary</span>
                <span class="n">sampler_str</span><span class="p">,</span> <span class="n">bin_style</span><span class="p">,</span> <span class="n">all_within_ci</span><span class="p">,</span> <span class="n">all_within_delta</span><span class="p">,</span> <span class="n">sampled_trials</span><span class="p">,</span>\
                    <span class="n">score_diff</span><span class="p">,</span>\
                    <span class="n">total_sampled_trials</span> <span class="o">=</span> \
                    <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;exp_sampler_type&quot;</span><span class="p">]),</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;bin_style&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;all_within_ci&quot;</span><span class="p">],</span> \
                    <span class="n">row</span><span class="p">[</span><span class="s2">&quot;all_within_delta&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sampled_trials&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;score_diff&quot;</span><span class="p">],</span> \
                    <span class="n">row</span><span class="p">[</span><span class="s2">&quot;total_sampled_trials&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">all_within_delta</span><span class="p">:</span>
                    <span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler_str</span><span class="p">)</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;bin_style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bin_style</span><span class="p">),</span> <span class="s1">&#39;num_within_delta&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">all_within_ci</span><span class="p">:</span>
                    <span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler_str</span><span class="p">)</span> <span class="o">&amp;</span>
                                   <span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;bin_style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bin_style</span><span class="p">),</span> <span class="s1">&#39;num_within_ci&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler_str</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;bin_style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bin_style</span><span class="p">),</span>
                               <span class="s1">&#39;total_relevant_samples&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">sampled_trials</span>
                <span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler_str</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;bin_style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bin_style</span><span class="p">),</span> <span class="s1">&#39;total_samples&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">total_sampled_trials</span>
                <span class="c1"># For score differences take all of the systems</span>
                <span class="c1"># and then divide by num_iterations*num_systems</span>
                <span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler_str</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;bin_style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bin_style</span><span class="p">),</span> <span class="s1">&#39;total_score_diff&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">score_diff</span>
                <span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;sampler_str&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sampler_str</span><span class="p">)</span> <span class="o">&amp;</span>
                               <span class="p">(</span><span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;bin_style&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">bin_style</span><span class="p">),</span> <span class="s1">&#39;total_score_diff_sq&#39;</span><span class="p">]</span> <span class="o">+=</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">score_diff</span><span class="p">)</span>
            <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;avg_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_samples&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">num_iterations</span> <span class="o">*</span> <span class="n">num_systems</span><span class="p">)</span>
            <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;avg_relevant_samples&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_relevant_samples&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span>
                <span class="n">num_iterations</span> <span class="o">*</span> <span class="n">num_systems</span><span class="p">)</span>
            <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;perc_within_delta&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;num_within_delta&#39;</span><span class="p">]</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">num_iterations</span> <span class="o">*</span> <span class="n">num_systems</span><span class="p">)</span>
            <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;perc_within_ci&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;num_within_ci&#39;</span><span class="p">]</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">num_iterations</span> <span class="o">*</span> <span class="n">num_systems</span><span class="p">)</span>
            <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;avg_score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;total_score_diff&#39;</span><span class="p">]</span> <span class="o">/</span> \
                <span class="nb">float</span><span class="p">(</span><span class="n">num_iterations</span> <span class="o">*</span> <span class="n">num_systems</span><span class="p">)</span>
            <span class="c1"># Use custom function compute_var</span>
            <span class="n">summary_df</span><span class="p">[</span><span class="s1">&#39;var_score_diff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">compute_var</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                                            <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">num_iterations</span> <span class="o">*</span> <span class="n">num_systems</span><span class="p">])</span>

            <span class="c1"># reorder columns, drop sampler_str column since not used</span>
            <span class="n">summary_out_df</span> <span class="o">=</span> <span class="n">summary_df</span><span class="p">[[</span><span class="s1">&#39;sampler_type&#39;</span><span class="p">,</span> <span class="s2">&quot;sampler_category&quot;</span><span class="p">,</span> <span class="s1">&#39;stratification_type&#39;</span><span class="p">,</span>
                                         <span class="s2">&quot;bin_style&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;uses_multinomial&quot;</span><span class="p">,</span> <span class="s2">&quot;avg_relevant_samples&quot;</span><span class="p">,</span> <span class="s2">&quot;avg_samples&quot;</span><span class="p">,</span>
                                         <span class="s1">&#39;avg_score_diff&#39;</span><span class="p">,</span> <span class="s2">&quot;perc_within_ci&quot;</span><span class="p">,</span> <span class="s2">&quot;perc_within_delta&quot;</span><span class="p">,</span>
                                         <span class="s1">&#39;var_score_diff&#39;</span><span class="p">,</span>
                                         <span class="s2">&quot;total_relevant_samples&quot;</span><span class="p">,</span> <span class="s2">&quot;total_samples&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;total_score_diff&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;num_within_ci&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;num_within_delta&quot;</span><span class="p">,</span> <span class="s2">&quot;total_score_diff_sq&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;metric_name&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;system_ordering&quot;</span><span class="p">]]</span>

            <span class="c1"># Add &quot;Sampler_category&quot; and &quot;Uses_multinomial&quot; from summary_df to results_df for</span>
            <span class="c1"># Extra columns for processing</span>
            <span class="c1"># Drop stratification_type column since summary_df has the one we actually want</span>
            <span class="n">results_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;stratification_type&#39;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">results_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">summary_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;sampler_type&#39;</span><span class="p">,</span> <span class="s2">&quot;bin_style&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;sampler_category&quot;</span><span class="p">,</span>
                                                             <span class="s2">&quot;uses_multinomial&quot;</span><span class="p">,</span>
                                                             <span class="s1">&#39;stratification_type&#39;</span><span class="p">]],</span>
                                          <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;sampler_type&quot;</span><span class="p">,</span> <span class="s2">&quot;bin_style&quot;</span><span class="p">])</span>
            <span class="c1"># Add score_diff to results df</span>
            <span class="n">results_column_ordering</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;iter_num&#39;</span><span class="p">,</span> <span class="s1">&#39;sampler_type&#39;</span><span class="p">,</span> <span class="s1">&#39;sampler_name&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;sampler_category&#39;</span><span class="p">,</span> <span class="s1">&#39;bin_style&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;uses_multinomial&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;num_step_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;num_success_rounds_required&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;num_strata&#39;</span><span class="p">,</span> <span class="s1">&#39;stratification_type&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;exp_bin_style&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;metric_object&#39;</span><span class="p">,</span> <span class="s1">&#39;exp_sampler_type&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;request_initial_samples&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;initial_samples&#39;</span><span class="p">,</span> <span class="s1">&#39;total_sampled_trials&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;num_rounds&#39;</span><span class="p">,</span> <span class="s1">&#39;num_init_trials&#39;</span><span class="p">,</span> <span class="s1">&#39;num_requested_init_trials&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;num_nonempty_strata&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;system_id&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">,</span> <span class="s1">&#39;score_diff&#39;</span><span class="p">,</span> <span class="s2">&quot;score_diff_sq&quot;</span><span class="p">,</span>
                                       <span class="s1">&#39;confidence_value&#39;</span><span class="p">,</span> <span class="s1">&#39;score_variance&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;sampled_trials&#39;</span><span class="p">,</span> <span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;system_within_ci&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;system_within_delta&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;all_within_ci&#39;</span><span class="p">,</span> <span class="s1">&#39;all_within_delta&#39;</span><span class="p">,</span>
                                       <span class="s1">&#39;actual_system_score&#39;</span><span class="p">,</span>
                                       <span class="s2">&quot;metric_name&quot;</span><span class="p">,</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;system_ordering&quot;</span><span class="p">]</span>
            <span class="n">results_out_df</span> <span class="o">=</span> <span class="n">results_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">results_column_ordering</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">global_logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># log exception info at FATAL log level</span>

        <span class="k">except</span> <span class="ne">Warning</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">global_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">exec_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">tmp_files_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./*.tmp&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">final_log_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">final_log_path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">tmp_files_list</span><span class="p">:</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                    <span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">infile</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">my_fname</span> <span class="ow">in</span> <span class="n">tmp_files_list</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">my_fname</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">summary_out_df</span><span class="p">,</span> <span class="n">results_out_df</span></div>

<div class="viewcode-block" id="OracleScript.run_experiment"><a class="viewcode-back" href="../../../api/aegis.oracle.oracle.html#aegis.oracle.oracle.OracleScript.run_experiment">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">oracle_ref</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">,</span> <span class="n">metric_object</span><span class="p">,</span>
                       <span class="n">stratification_type</span><span class="p">,</span>
                       <span class="n">num_strata</span><span class="p">,</span> <span class="n">system_ordering</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sampler_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">sampler_categories</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">bin_style_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">use_multinomials</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">num_success_rounds_required</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                       <span class="n">num_step_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                       <span class="n">num_iterations</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">use_initial_df</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">request_initial_samples</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">initial_samples</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">parallelize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                       <span class="n">run_id</span><span class="o">=</span><span class="s2">&quot;experiment_0&quot;</span><span class="p">,</span>
                       <span class="n">batch_id</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
                       <span class="n">git_commit_hash</span><span class="o">=</span><span class="s2">&quot;No Git Commit Hash Provided&quot;</span><span class="p">,</span>
                       <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                       <span class="n">sample_first</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="n">num_req_systems</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs a specified &quot;experiment&quot;, which takes the submission with the specified metric,</span>
<span class="sd">        stratification</span>
<span class="sd">        type and experimental parameters, and runs on samplers and with strataficiation bin</span>
<span class="sd">        styles as specified, running each experiment as specified. Calls</span>
<span class="sd">        :func:`aegis.oracle.oracle.OracleScript.get_specific_experiment_result_data()`</span>

<span class="sd">        Args:</span>
<span class="sd">            oracle_ref (:obj:`aegis.oracle.oracle.Oracle`):</span>
<span class="sd">                the Oracle object to call to get additional trials</span>
<span class="sd">            input_dir (str): The path to the input directory of the submission</span>
<span class="sd">            output_dir (str): The path to the output directory to create the results in.</span>
<span class="sd">            metric_object (:obj:`aegis.acteval.metrics.Metric`):</span>
<span class="sd">                The reference to the metric object that specifies how the trials will be scored</span>
<span class="sd">            stratification_type (:obj:`aegis.acteval.strata.Strata`):</span>
<span class="sd">                Strata class that gives the stratification strategy and type of strata</span>
<span class="sd">            num_strata (int): The number of strata to have.</span>
<span class="sd">            system_ordering (list of str): The desired ordering of systems, if the order</span>
<span class="sd">                is important. Order is specified by system id.</span>
<span class="sd">                None, which resolves to [] By</span>
<span class="sd">                default. One can also give an ordering of only some of the systems to run the</span>
<span class="sd">                experiment on a subset of systems in the submission. [] Runs all systems in an</span>
<span class="sd">                arbitrary ordering.</span>
<span class="sd">            sampler_types (list of :obj:`abc.ABCMeta`, optional):</span>
<span class="sd">                List of samplers you wish to use in experiment</span>
<span class="sd">            sampler_categories (list of str, optional): List of sampler categories you</span>
<span class="sd">                want to use in experiment. Defaults to None, which resolves as [].</span>
<span class="sd">            bin_style_types (list of str, optional): List of bin style types you want to</span>
<span class="sd">                use in experiment. Defaults to None, which resolves as [].</span>
<span class="sd">            use_multinomials (list of bool, optional): List of booleans for each sampler type</span>
<span class="sd">                Defaults to None, which resolves as [].</span>
<span class="sd">            num_success_rounds_required (int, optional):</span>
<span class="sd">                The number of rounds where the (1-\\alpha) confidence</span>
<span class="sd">                interval&#39;s range is within +- $\\delta width. Defaults to 2</span>
<span class="sd">            num_step_samples (int, optional): the number of samples to ask for at each iteration</span>
<span class="sd">                defaults to 100</span>
<span class="sd">            alpha (num, optional): The specified probability \\alpha. Defaults to 0.05.</span>
<span class="sd">            delta (num, optional): The specified interval range \\delta. Defaults to 0.01</span>
<span class="sd">            num_iterations (int, optional): The number of iterations to run each sampler for.</span>
<span class="sd">                Defaults to 1000</span>
<span class="sd">            use_initial_df (bool, optional): A variable that tells is to use an initial</span>
<span class="sd">                data frame if provided</span>
<span class="sd">                for initial samples. Defaults to True.</span>
<span class="sd">            request_initial_samples (bool, optional):</span>
<span class="sd">                A boolean that determines if the experiment (and hence) the</span>
<span class="sd">                controller should request or supplement initial samples with initial samples</span>
<span class="sd">                to provide for adequate stratum and metric coverage for initial estimates.</span>
<span class="sd">                True by default.</span>
<span class="sd">            initial_samples (int, optional): The number of samples to request initially.</span>
<span class="sd">                Defaults to 100.</span>
<span class="sd">            parallelize (bool, optional): A boolean determining whether to parallelize. True</span>
<span class="sd">                parallelizes with joblib, False runs in serial. Defaults to True</span>
<span class="sd">            run_id (str, optional): An optional run_id value to add to the date.</span>
<span class="sd">                Default &quot;experiment_0&quot;, but recommended</span>
<span class="sd">                to be a combination of the submission name and the experiment parameters.</span>
<span class="sd">            batch_id (str, optional): An optional batch_id value to add, the date by default</span>
<span class="sd">            git_commit_hash (str, optional): The string of the git commit hash of this code.</span>
<span class="sd">                If provided, it will write it to a text file git_commit_hash.txt.</span>
<span class="sd">                Default value is &quot;No Git Commit Hash Provided&quot; so that we have something</span>
<span class="sd">                to a file.</span>
<span class="sd">            random_seed (int, optional): The desired random seed. Set to None if it is desired</span>
<span class="sd">                for the experiment to not be seeded. Defaults to None.</span>
<span class="sd">                for the experiment to not be seeded.</span>
<span class="sd">            sample_first (bool): A variable that tells the experiment to obtain samples before</span>
<span class="sd">                stratification</span>
<span class="sd">            num_req_system (int, optional): Used to request a certain number of systems,</span>
<span class="sd">                    used for specific strata techniques.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Nothing. Directory Output_dir is created if it does not exist and additional</span>
<span class="sd">            files from the experiment (including subfolders) are created. Files existing with the</span>
<span class="sd">            same name as created files are overwritten, but files of other names are not deleted.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">system_ordering</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">system_ordering</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">sampler_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sampler_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">UniformTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">UniformFixedTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">ProportionalTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">ProportionalFixedTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">AdaptiveTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">AdaptiveFixedTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomTrialSampler</span><span class="p">,</span>
                             <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">samplers</span><span class="o">.</span><span class="n">RandomFixedTrialSampler</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sampler_categories</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sampler_categories</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Uniform&quot;</span><span class="p">,</span> <span class="s2">&quot;Uniform&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Proportional&quot;</span><span class="p">,</span> <span class="s2">&quot;Proportional&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Adaptive&quot;</span><span class="p">,</span> <span class="s2">&quot;Adaptive&quot;</span><span class="p">,</span>
                                  <span class="s2">&quot;Random&quot;</span><span class="p">,</span> <span class="s2">&quot;Random&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">bin_style_types</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bin_style_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span> <span class="s1">&#39;perc&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">use_multinomials</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">use_multinomials</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span>
                                <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

        <span class="c1"># Organize runs by batch and then by run</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;paper_experiments_logger&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">hdlr</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>  <span class="c1"># remove all old handlers</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">hdlr</span><span class="p">)</span>
        <span class="n">final_logfile_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">batch_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.log&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">final_logfile_fpath</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;batch_id: </span><span class="si">{batch_id}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;input_dir: </span><span class="si">{input_dir}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;run_id: </span><span class="si">{run_id}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;random_seed: </span><span class="si">{random_seed}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">stratification_type_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">system_ordering_string</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">system_ordering</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;stratification_type_string: </span><span class="si">{stratification_type_string}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;system_ordering_string: </span><span class="si">{system_ordering_string}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exp_output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">batch_id</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">exp_output_dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">exp_output_dir</span><span class="p">)</span>

            <span class="c1"># Write the git commit hash as a text file</span>
            <span class="n">git_commit_hash_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_output_dir</span><span class="p">,</span> <span class="s2">&quot;git_commit_hash.txt&quot;</span><span class="p">)</span>
            <span class="n">git_fobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">git_commit_hash_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">git_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">git_commit_hash</span><span class="p">)</span>
            <span class="n">git_fobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Now write the experimental parameters to a file</span>
            <span class="n">exp_params_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_output_dir</span><span class="p">,</span> <span class="s2">&quot;experimental_params.txt&quot;</span><span class="p">)</span>
            <span class="n">exp_fobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">exp_params_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;batch_id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">batch_id</span><span class="p">))</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">run_id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">run_id</span><span class="p">))</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">input_dir: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_dir</span><span class="p">))</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">system ordering: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">system_ordering</span><span class="p">))</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">random seed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">random_seed</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;paper_experiments_logger&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span> <span class="o">+</span>
                                       <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">hdlr</span> <span class="ow">in</span> <span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">[:]:</span>  <span class="c1"># remove all old handlers</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">hdlr</span><span class="p">)</span>
            <span class="n">logfile_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span>
                                         <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.tmp&#39;</span><span class="p">)</span>
            <span class="n">fh</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">logfile_fpath</span><span class="p">)</span>
            <span class="n">fh</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">fh</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Experiment&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">stratification_type</span><span class="p">)</span> <span class="o">+</span>
                        <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">))</span>
            <span class="n">exp_obj</span> <span class="o">=</span> <span class="n">aegis</span><span class="o">.</span><span class="n">acteval</span><span class="o">.</span><span class="n">experiment</span><span class="o">.</span> \
                <span class="n">ExperimentParams</span><span class="p">(</span><span class="n">num_step_samples</span><span class="o">=</span><span class="n">num_step_samples</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
                                 <span class="n">num_success_rounds_required</span><span class="o">=</span><span class="n">num_success_rounds_required</span><span class="p">,</span>
                                 <span class="n">num_strata</span><span class="o">=</span><span class="n">num_strata</span><span class="p">,</span>
                                 <span class="n">metric_object</span><span class="o">=</span><span class="n">metric_object</span><span class="p">,</span>
                                 <span class="n">stratification_type</span><span class="o">=</span><span class="n">stratification_type</span><span class="p">,</span>
                                 <span class="n">sampler_type</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">,</span>
                                 <span class="n">bin_style</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\&#39;</span><span class="s2">&lt;Varying Experimental Factor&gt;</span><span class="se">\&#39;</span><span class="s2">&quot;</span><span class="p">,</span>
                                 <span class="n">request_initial_samples</span><span class="o">=</span><span class="n">request_initial_samples</span><span class="p">,</span>
                                 <span class="n">initial_samples</span><span class="o">=</span><span class="n">initial_samples</span><span class="p">,</span>
                                 <span class="n">sample_first</span><span class="o">=</span><span class="n">sample_first</span><span class="p">,</span>
                                 <span class="n">num_req_systems</span><span class="o">=</span><span class="n">num_req_systems</span><span class="p">)</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exp_obj</span><span class="p">))</span>
            <span class="n">exp_fobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="p">(</span><span class="n">summary_out_df</span><span class="p">,</span> <span class="n">results_out_df</span><span class="p">)</span> <span class="o">=</span> <span class="n">aegis</span><span class="o">.</span><span class="n">oracle</span><span class="o">.</span><span class="n">oracle</span><span class="o">.</span><span class="n">OracleScript</span><span class="o">.</span> \
                <span class="n">get_experiment_result_data</span><span class="p">(</span>
                <span class="n">oracle_ref</span><span class="p">,</span>
                <span class="n">sampler_types</span><span class="o">=</span><span class="n">sampler_types</span><span class="p">,</span>
                <span class="n">sampler_categories</span><span class="o">=</span><span class="n">sampler_categories</span><span class="p">,</span>
                <span class="n">bin_style_types</span><span class="o">=</span><span class="n">bin_style_types</span><span class="p">,</span>
                <span class="n">use_multinomials</span><span class="o">=</span><span class="n">use_multinomials</span><span class="p">,</span>
                <span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">,</span>
                <span class="n">metric_object</span><span class="o">=</span><span class="n">metric_object</span><span class="p">,</span>
                <span class="n">stratification_type</span><span class="o">=</span><span class="n">stratification_type</span><span class="p">,</span>
                <span class="n">num_strata</span><span class="o">=</span><span class="n">num_strata</span><span class="p">,</span>
                <span class="n">system_ordering</span><span class="o">=</span><span class="n">system_ordering</span><span class="p">,</span>
                <span class="n">num_success_rounds_required</span><span class="o">=</span><span class="n">num_success_rounds_required</span><span class="p">,</span>
                <span class="n">num_step_samples</span><span class="o">=</span><span class="n">num_step_samples</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span>
                <span class="n">num_iterations</span><span class="o">=</span><span class="n">num_iterations</span><span class="p">,</span>
                <span class="n">use_initial_df</span><span class="o">=</span><span class="n">use_initial_df</span><span class="p">,</span>
                <span class="n">request_initial_samples</span><span class="o">=</span><span class="n">request_initial_samples</span><span class="p">,</span>
                <span class="n">initial_samples</span><span class="o">=</span><span class="n">initial_samples</span><span class="p">,</span>
                <span class="n">parallelize</span><span class="o">=</span><span class="n">parallelize</span><span class="p">,</span>
                <span class="n">random_seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">,</span>
                <span class="n">final_log_path</span><span class="o">=</span><span class="n">final_logfile_fpath</span><span class="p">,</span>
                <span class="n">sample_first</span><span class="o">=</span><span class="n">sample_first</span><span class="p">,</span>
                <span class="n">num_req_systems</span><span class="o">=</span><span class="n">num_req_systems</span><span class="p">)</span>

            <span class="n">summary_out_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_output_dir</span><span class="p">,</span> <span class="s2">&quot;summary_of_results.csv&quot;</span><span class="p">),</span>
                                  <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                  <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">results_out_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">exp_output_dir</span><span class="p">,</span> <span class="s2">&quot;individual_run_results.csv&quot;</span><span class="p">),</span>
                                  <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># log exception info at FATAL log level</span>
        <span class="k">except</span> <span class="ne">Warning</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">exec_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, NIST MIG

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>